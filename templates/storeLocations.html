<!DOCTYPE html>
{% load leaflet_tags %}
<html lang="en">
<head>
    {% leaflet_js %}
    {% leaflet_css %}
    <meta charset="UTF-8">
    <title>Retailer Stores Locations </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
        //load municipalilties as per selected region

        $(document).ready(function()
        {
        var $regions=$('#regions'),
            $municipalities=$('#municipalities'),
            $options=$municipalities.find('option');
            $regions.on('change', function()
            {

                $municipalities.html($options.filter('[value="'+this.value+'"]'));

                //append a default value to the municipalities dropdown list
                $('#municipalities').append($('<option>', {
                value: 0,
                text: '---Select Municipality---',
                selected:true
                }));

        //sort municipality names alphabetically
        $(function()
        {
        var options = $("#municipalities option");
            options.sort(function(a,b)
            {
                if (a.text > b.text) return 1; // .text for text comparison
                    else if (a.text < b.text) return -1;
                else return 0
            });
        $("#municipalities").html(options);
        });

            }).trigger('change');

        });

    </script>

    <script>
        $(function()
        {
        var options = $("#retailers option");
            options.sort(function(a,b)
            {
             if (a.text > b.text) return 1; // .text for text comparison
                else if (a.text < b.text) return -1;
             else return 0
            });
        $("#retailers").html(options);
        });

        $(function()
        {
        var options = $("#regions option");
            options.sort(function(a,b)
            {
             if (a.text > b.text) return 1; // .text for text comparison
                    else if (a.text < b.text) return -1;
                else return 0
             });
        $("#regions").html(options);
        });

    </script>

</head>
<body>
<h1>Store Locations</h1>
<form action="">
     <label for="retailers">Retailer</label><br>
     <select id="retailers" name="retailers" style="width: 170px;" sort="True">
        <option disabled="true" selected>---Select Retailer---</option>
        {% for result in retailers %}
         <option>{{result.retailer_name}}</option>
        {% endfor %}
     </select>

     <br><br>

     <label for="regions">Region</label><br>
     <select id="regions" name="regions" style="width: 170px;">
        <option selected>---Select Region---</option>
        {% for result in regions %}
        <option value="{{result.region_id}}">{{result.region_name}}</option>
        {% endfor %}
     </select>

    <br><br>

     <label for="municipalities">Municipality</label><br>
     <select id="municipalities" name="municipalities" style="width: 170px;">
        {% for result in municipalities %}
        <option value="{{result.region_id}}">{{result.municipality_name}}</option>
        {% endfor %}
     </select>
</form>

    <br>
    {% leaflet_map "main" callback="main_map_init" %}
    <script type="text/javascript">
        function main_map_init (map, options)
        {
            // get point lat and lon
            //var lon = "{{ city.geometry.x }}";
            //var lat = "{{ city.geometry.y }}";

             // zoom to point & add it to map
          // map.setView([60.494535, 15.399587],5);
          // L.marker([60.494535, 15.399587]).addTo(map);

           for (let sl=0; sl<=50; sl++)
           {
           var lat = "{{ stores.store_lat }}";
           var lon = "{{ stores.store_long }}";
           map.setView([lat, lon],5);
           L.marker([lat, lon]).addTo(map);
           }

            //map.setView([65.6186857, 22.0541646], map.getZoom(), {
            //"animate": true,
            //"pan": {
            //"duration": 10
             //}
            //});
            //L.marker([65.6186857, 22.0541646]).addTo(map);

        }
    </script>
</body>
</html>